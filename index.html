<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Personal Details Form - University of Eldoret</title>
    <link rel="stylesheet" href="styles.css?v=2.5">
    
    <!-- Firebase SDK v10 (modular) -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js';
        import { getFirestore } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js';
        
        // Your Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCQ4B3CdAJ4WoFu-bPlZQtLgdpHvkXTK0w",
            authDomain: "uoe-student-form.firebaseapp.com",
            projectId: "uoe-student-form",
            storageBucket: "uoe-student-form.firebasestorage.app",
            messagingSenderId: "1023597600972",
            appId: "1:1023597600972:web:4a79cca07365059d392269",
            measurementId: "G-HS1FV2ZS80"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        
        // Make Firebase services available globally
        window.db = getFirestore(app);
        window.analytics = getAnalytics(app);
        
        console.log('🔥 Firebase initialized successfully');
    </script>
    
    <!-- PDF generation libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- Additional CSS for cascading dropdowns -->
    <style>
        .location-field-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 8px;
        }
        
        .location-dropdown {
            border: none;
            border-bottom: 1px solid #000 !important;
            padding: 2px 5px;
            font-family: inherit;
            font-size: 12px;
            background: transparent !important;
            min-width: 120px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23000" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 5px center;
            background-size: 12px;
            padding-right: 25px;
        }
        
        .location-dropdown:disabled {
            opacity: 0.6;
            background-color: #f5f5f5 !important;
            cursor: not-allowed;
        }
        
        .location-dropdown:focus {
            outline: none !important;
            background-color: #f0f8ff !important;
            border-bottom-color: #2a5298 !important;
        }
        
        .loading-dropdown {
            background-image: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 1v6M12 17v6M4.22 4.22l4.24 4.24M15.54 15.54l4.24 4.24M1 12h6M17 12h6M4.22 19.78l4.24-4.24M15.54 8.46l4.24-4.24"/></svg>') !important;
            background-size: 16px !important;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .location-help-text {
            font-size: 10px;
            color: #666;
            margin-top: 2px;
            font-style: italic;
        }
        
        .location-error {
            background-color: #ffe6e6 !important;
            border-bottom-color: #dc3545 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Section -->
        <div class="header">
            <div class="header-content">
                <div class="university-logo">
                    <img src="logo.png" alt="University of Eldoret Logo" id="universityLogo" onerror="handleLogoError()">
                </div>
                
                <div class="header-center">
                    <h1>University of<br>Eldoret</h1>
                    <p class="tagline">Excellence in Innovation and Development</p>
                    <h2>OFFICE OF DEPUTY VICE-CHANCELLOR (ASA)<br>REGISTRAR ACADEMIC</h2>
                </div>
                
                <div class="contact-info">
                    <div class="reference">UoE/J/2</div>
                    <div>P. O. Box 1125 - 30100, Eldoret, Kenya Tel:</div>
                    <div>+254 53 2063257 / 2033212/13 Ext. 2552/3</div>
                    <div>Mob: 0736 495550; Fax: +254 53 206 3257 E-</div>
                    <div>mail: registraracademic@uoeld.ac.ke</div>
                    <div>Website: www.uoeld.ac.ke</div>
                </div>
            </div>
            
            <div class="photo-box">
                <div class="photo-placeholder">
                    Affix your<br>
                    Passport size<br>
                    Photo here
                </div>
            </div>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            Form completed successfully! Your data has been submitted.
        </div>

        <!-- Form Content -->
        <div class="form-content">
            <h2 class="form-title">STUDENT'S PERSONAL DETAILS</h2>
            
            <div class="instruction-text">
                Information provided in this Form is intended to help the office of the Registrar 
                Academic understand the student better. It will be used for purposes of improving 
                the student's welfare while at the University. (To be completed in quadruple (4 
                copies) and in capital letters. <strong>Attach a coloured passport size photograph taken on a 
                yellow background on each form.</strong>
            </div>
            
            <div class="note-text">
                <strong>Note:</strong> You are required to enter through the link below the same information 
                filled in hard copy forms. http://support.uoeld.ac.ke/admissions/
            </div>

            <form id="studentForm">
                <!-- Personal Details -->
                <div class="form-field">
                    <span class="field-number">1.</span>
                    <span class="field-label">Full Name:</span>
                    <input type="text" class="field-input name-input" id="fullName" required>
                    <div class="name-labels">
                        <span class="sub-label">(Surname or last Name)</span>
                        <span class="sub-label">(Other Names)</span>
                    </div>
                </div>

                <div class="two-column">
                    <div class="form-field">
                        <span class="field-number">2.</span>
                        <span class="field-label">University Admission Number</span>
                        <input type="text" class="field-input" id="admissionNumber" required>
                    </div>
                    <div class="form-field">
                        <span class="field-label">Phone No.</span>
                        <input type="tel" class="field-input" id="phoneNumber" required>
                    </div>
                </div>

                <div class="form-field triple-field">
                    <span class="field-number">3.</span>
                    <div class="field-group">
                        <span class="field-label">National ID No.</span>
                        <input type="text" class="field-input" id="nationalId" required>
                    </div>
                    <div class="field-group">
                        <span class="field-label">Passport No.</span>
                        <input type="text" class="field-input" id="passportNo">
                    </div>
                    <div class="field-group">
                        <span class="field-label">or Birth Certificate No. if under 18 years</span>
                        <input type="text" class="field-input" id="birthCertNo">
                    </div>
                </div>

                <div class="form-field triple-field">
                    <span class="field-number">4.</span>
                    <div class="field-group">
                        <span class="field-label">Religion</span>
                        <input type="text" class="field-input" id="religion">
                    </div>
                    <div class="field-group">
                        <span class="field-label">Nationality</span>
                        <input type="text" class="field-input" id="nationality" required>
                    </div>
                    <div class="field-group">
                        <span class="field-label">Gender</span>
                        <select class="field-input" id="gender" required>
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <div class="form-field">
                    <span class="field-number">5.</span>
                    <span class="field-label">Ethnic Background</span>
                    <input type="text" class="field-input" id="ethnicBackground">
                </div>

                <div class="two-column">
                    <div class="form-field">
                        <span class="field-number">6.</span>
                        <span class="field-label">Date of Birth</span>
                        <input type="date" class="field-input" id="dateOfBirth" required>
                    </div>
                    <div class="form-field">
                        <span class="field-label">Place of Birth:</span>
                        <input type="text" class="field-input" id="placeOfBirth" required>
                    </div>
                </div>

                <div class="form-field">
                    <span class="field-number">7.</span>
                    <span class="field-label">Place of Permanent Residence: Village/Town</span>
                    <input type="text" class="field-input" id="permanentResidence" required>
                </div>

                <div class="two-column">
                    <div class="form-field">
                        <span class="field-number">8.</span>
                        <span class="field-label">Location</span>
                        <input type="text" class="field-input" id="location" required>
                    </div>
                    <div class="form-field">
                        <span class="field-label">Name of Chief</span>
                        <input type="text" class="field-input" id="chiefName">
                    </div>
                </div>

                <!-- Enhanced Administrative Location Fields -->
                <div class="form-field">
                    <span class="field-number">9.</span>
                    <span class="field-label">Administrative Location (Select in order):</span>
                </div>
                
                <div class="form-field triple-field" style="margin-left: 25px;">
                    <div class="field-group location-field-group">
                        <span class="field-label">County</span>
                        <select class="location-dropdown" id="county" required>
                            <option value="">Loading counties...</option>
                        </select>
                        <span class="location-help-text">Select your county first</span>
                    </div>
                    <div class="field-group location-field-group">
                        <span class="field-label">Sub County</span>
                        <select class="location-dropdown" id="subCounty" disabled required>
                            <option value="">Select county first</option>
                        </select>
                        <span class="location-help-text">Will populate after county selection</span>
                    </div>
                    <div class="field-group location-field-group">
                        <span class="field-label">Constituency</span>
                        <select class="location-dropdown" id="constituency" disabled required>
                            <option value="">Select sub-county first</option>
                        </select>
                        <span class="location-help-text">Will populate after sub-county selection</span>
                    </div>
                </div>

                <div class="form-field" style="margin-left: 25px;">
                    <div class="field-group location-field-group" style="max-width: 300px;">
                        <span class="field-label">Ward</span>
                        <select class="location-dropdown" id="ward" disabled>
                            <option value="">Select constituency first</option>
                        </select>
                        <span class="location-help-text">Optional: Will populate after constituency selection</span>
                    </div>
                </div>

                <!-- Keep original division field for compatibility -->
                <div class="form-field" style="margin-left: 25px;">
                    <span class="field-label">Division (if known)</span>
                    <input type="text" class="field-input" id="division" placeholder="Optional administrative division">
                </div>

                <div class="two-column">
                    <div class="form-field">
                        <span class="field-number">10.</span>
                        <span class="field-label">Nearest Town</span>
                        <input type="text" class="field-input" id="nearestTown">
                    </div>
                    <div class="form-field">
                        <span class="field-label">Nearest Police Station</span>
                        <input type="text" class="field-input" id="nearestPolice">
                    </div>
                </div>

                <div class="form-field">
                    <span class="field-number">11.</span>
                    <span class="field-label">Home Contact Address</span>
                    <input type="text" class="field-input" id="homeAddress">
                </div>

                <!-- Marital Status -->
                <div class="form-field">
                    <span class="field-number">12.</span>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" name="maritalStatus" value="Married" id="married">
                            <label for="married">Married</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" name="maritalStatus" value="Single" id="single">
                            <label for="single">Single</label>
                        </div>
                    </div>
                </div>

                <div class="form-field indented">
                    <span class="field-label">Name and Address of Spouse (if married)</span>
                    <input type="text" class="field-input" id="spouseDetails">
                </div>

                <div class="two-column indented">
                    <div class="form-field">
                        <span class="field-label">Occupation of Spouse</span>
                        <input type="text" class="field-input" id="spouseOccupation">
                    </div>
                    <div class="form-field">
                        <span class="field-label">Number of Children:</span>
                        <input type="number" class="field-input" id="numberOfChildren" min="0">
                    </div>
                </div>

                <!-- Father's Information -->
                <div class="form-field">
                    <span class="field-number">13.</span>
                    <span class="field-label">Full Name of Father</span>
                    <input type="text" class="field-input father-name" id="fatherName">
                    <div class="status-checkboxes">
                        <div class="checkbox-item inline">
                            <input type="checkbox" name="fatherStatus" value="Alive" id="fatherAlive">
                            <label for="fatherAlive">Alive</label>
                        </div>
                        <div class="checkbox-item inline">
                            <input type="checkbox" name="fatherStatus" value="Deceased" id="fatherDeceased">
                            <label for="fatherDeceased">Deceased</label>
                        </div>
                    </div>
                </div>

                <div class="form-field indented two-part">
                    <div class="field-group">
                        <span class="field-label">Phone No.</span>
                        <input type="tel" class="field-input" id="fatherPhone">
                    </div>
                    <div class="field-group">
                        <span class="field-label">National ID/Passport No.</span>
                        <input type="text" class="field-input" id="fatherIdNo">
                    </div>
                </div>

                <div class="two-column indented">
                    <div class="form-field">
                        <span class="field-label">Occupation of Father</span>
                        <input type="text" class="field-input" id="fatherOccupation">
                    </div>
                    <div class="form-field">
                        <span class="field-label">Date of Birth</span>
                        <input type="date" class="field-input" id="fatherDob">
                    </div>
                </div>

                <!-- Mother's Information -->
                <div class="form-field">
                    <span class="field-number">14.</span>
                    <span class="field-label">Full Name of Mother</span>
                    <input type="text" class="field-input mother-name" id="motherName">
                    <div class="status-checkboxes">
                        <div class="checkbox-item inline">
                            <input type="checkbox" name="motherStatus" value="Alive" id="motherAlive">
                            <label for="motherAlive">Alive</label>
                        </div>
                        <div class="checkbox-item inline">
                            <input type="checkbox" name="motherStatus" value="Deceased" id="motherDeceased">
                            <label for="motherDeceased">Deceased</label>
                        </div>
                    </div>
                </div>

                <div class="form-field indented two-part">
                    <div class="field-group">
                        <span class="field-label">Phone No.</span>
                        <input type="tel" class="field-input" id="motherPhone">
                    </div>
                    <div class="field-group">
                        <span class="field-label">National ID/Passport No.</span>
                        <input type="text" class="field-input" id="motherIdNo">
                    </div>
                </div>

                <div class="two-column indented">
                    <div class="form-field">
                        <span class="field-label">Occupation of Mother</span>
                        <input type="text" class="field-input" id="motherOccupation">
                    </div>
                    <div class="form-field">
                        <span class="field-label">Date of Birth</span>
                        <input type="date" class="field-input" id="motherDob">
                    </div>
                </div>

                <!-- Siblings -->
                <div class="form-field">
                    <span class="field-number">15.</span>
                    <span class="field-label">Names of Brothers and Sisters</span>
                </div>
                <div class="siblings-grid">
                    <div class="sibling-field">
                        <span class="sibling-number">1.</span>
                        <input type="text" class="field-input" id="sibling1">
                    </div>
                    <div class="sibling-field">
                        <span class="sibling-number">2.</span>
                        <input type="text" class="field-input" id="sibling2">
                    </div>
                    <div class="sibling-field">
                        <span class="sibling-number">3.</span>
                        <input type="text" class="field-input" id="sibling3">
                    </div>
                    <div class="sibling-field">
                        <span class="sibling-number">4.</span>
                        <input type="text" class="field-input" id="sibling4">
                    </div>
                    <div class="sibling-field">
                        <span class="sibling-number">5.</span>
                        <input type="text" class="field-input" id="sibling5">
                    </div>
                    <div class="sibling-field">
                        <span class="sibling-number">6.</span>
                        <input type="text" class="field-input" id="sibling6">
                    </div>
                </div>

                <!-- Emergency Contacts -->
                <div class="form-field">
                    <span class="field-number">16.</span>
                    <span class="field-label">Give names and address of two persons who can be contacted in case of an emergency.</span>
                </div>

                <div class="emergency-section">
                    <div class="form-field">
                        <span class="emergency-label">(e) Name</span>
                        <input type="text" class="field-input emergency-name" id="emergency1Name" required>
                        <span class="field-label relationship-label">Relationship</span>
                        <input type="text" class="field-input emergency-relationship" id="emergency1Relationship" required>
                    </div>
                    <div class="form-field indented two-part">
                        <div class="field-group">
                            <span class="field-label">National ID No.:</span>
                            <input type="text" class="field-input" id="emergency1Id">
                        </div>
                        <div class="field-group">
                            <span class="field-label">Phone No.:</span>
                            <input type="tel" class="field-input" id="emergency1Phone" required>
                        </div>
                    </div>
                    <div class="form-field indented">
                        <span class="field-label">Address:</span>
                        <input type="text" class="field-input" id="emergency1Address">
                    </div>

                    <div class="form-field">
                        <span class="emergency-label">(f) Name</span>
                        <input type="text" class="field-input emergency-name" id="emergency2Name">
                        <span class="field-label relationship-label">Relationship</span>
                        <input type="text" class="field-input emergency-relationship" id="emergency2Relationship">
                    </div>
                    <div class="form-field indented two-part">
                        <div class="field-group">
                            <span class="field-label">National ID No.:</span>
                            <input type="text" class="field-input" id="emergency2Id">
                        </div>
                        <div class="field-group">
                            <span class="field-label">Phone No.:</span>
                            <input type="tel" class="field-input" id="emergency2Phone">
                        </div>
                    </div>
                    <div class="form-field indented">
                        <span class="field-label">Address:</span>
                        <input type="text" class="field-input" id="emergency2Address">
                    </div>
                </div>

                <!-- Educational Background -->
                <div class="form-field">
                    <span class="field-number">17.</span>
                    <span class="field-label">Name and address of Secondary School attended</span>
                    <input type="text" class="field-input" id="schoolAttended">
                </div>
                <div class="form-field indented">
                    <span class="field-label">Address:</span>
                    <input type="text" class="field-input" id="schoolAddress">
                </div>

                <div class="form-field">
                    <span class="field-number">18.</span>
                    <span class="field-label">K.C.S.E Results (Subjects and Grades) and Year</span>
                </div>
                <div class="kcse-results">
                    <input type="text" class="field-input result-line" id="kcseResults" placeholder="List all subjects and grades">
                    <input type="text" class="field-input result-line" id="kcseResults2" placeholder="Continue subjects and grades">
                    <div class="form-field">
                        <span class="field-label">Index Number</span>
                        <input type="text" class="field-input" id="indexNumber">
                    </div>
                    <div class="form-field">
                        <span class="field-label">KCSE Year</span>
                        <input type="number" class="field-input" id="kcseYear" min="1990" max="2030" placeholder="e.g., 2023">
                    </div>
                </div>

                <div class="form-field">
                    <span class="field-number">19.</span>
                    <span class="field-label">Any other institutions/attended and qualifications attained</span>
                </div>
                <div class="indented">
                    <input type="text" class="field-input full-width" id="otherInstitutions">
                </div>

                <div class="form-field">
                    <span class="field-number">20.</span>
                    <span class="field-label">Which games/Sports are you interested in?</span>
                    <input type="text" class="field-input" id="sportsInterests">
                </div>

                <div class="form-field">
                    <span class="field-number">21.</span>
                    <span class="field-label">Which clubs/societies/hobbies are you interested in?</span>
                    <input type="text" class="field-input" id="clubsInterests">
                </div>

                <div class="form-field">
                    <span class="field-number">22.</span>
                    <span class="field-label">Do you suffer from any physical impairment? If so give details</span>
                </div>
                <div class="indented">
                    <input type="text" class="field-input full-width" id="physicalImpairment">
                </div>

                <div class="form-field">
                    <span class="field-number">23.</span>
                    <span class="field-label">Please give any information you think is useful for you to communicate to the University:</span>
                </div>
                <div class="indented">
                    <input type="text" class="field-input full-width" id="additionalInfo">
                </div>

                <!-- Certification -->
                <div class="certification">
                    I certify that the information I have provided is correct.
                </div>

                <!-- Signature Section -->
                <div class="signature-section">
                    <div class="signature-field">
                        <span>Signature</span>
                        <div class="signature-line"></div>
                    </div>
                    <div class="signature-field">
                        <span>Date</span>
                        <div class="signature-line"></div>
                    </div>
                </div>
            </form>

            <!-- ISO Certification with Logo -->
            <div class="footer-section">
                <div class="university-footer-logo">
                    <img src="logo.png" alt="University of Eldoret Logo" id="footerLogo" onerror="handleFooterLogoError()">
                </div>
                <div class="iso-certification">
                    <strong>University of Eldoret is ISO 9001:2015 Certified</strong>
                    <div class="iso-logo">🏆</div>
                </div>
            </div>
        </div>

        <!-- Pre-Submission Section (Web Only - Not Printed) -->
        <div class="pre-submission-section">
            <!-- Printing Instructions -->
            <div class="printing-instructions">
                <h3>📋 Important Instructions</h3>
                <div class="instruction-box">
                    <p><strong>University Requirement:</strong> You must print <span class="highlight">FOUR (4) copies</span> of this completed form for submission.</p>
                    <p><strong>Photo Requirement:</strong> Attach a colored passport-size photograph taken on a yellow background to each of the 4 copies.</p>
                    <p><strong>Submission:</strong> Submit all 4 copies with photos attached to the Registrar Academic office.</p>
                </div>
            </div>

            <!-- Data Protection Consent -->
            <div class="data-protection-section">
                <h3>🔒 Data Protection Consent</h3>
                <div class="data-protection-notice">
                    <div class="consent-checkbox">
                        <input type="checkbox" id="dataConsent" required>
                        <label for="dataConsent">
                            <strong>I consent to the University of Eldoret collecting, storing, and processing my personal data provided in this admission form for the purposes of admission, academic administration, and related services. I understand that my data will be kept securely and only used for the stated purposes in compliance with the Data Protection Act, 2019.</strong>
                        </label>
                    </div>
                    <div class="consent-checkbox" style="margin-top: 15px;">
                        <input type="checkbox" id="dataRights" required>
                        <label for="dataRights">
                            <strong>I acknowledge that I have the right to access, correct, or request deletion of my personal data, and to withdraw my consent at any time by contacting the University through the designated office or email address.</strong> <span class="required">*</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Form Actions (Web Only) - Updated with Submit Button -->
        <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="clearForm()">Clear Form</button>
            <button type="button" class="btn" onclick="submitForm()" style="background: linear-gradient(135deg, #28a745 0%, #20a039 100%);">Submit Form</button>
            <button type="button" class="btn" onclick="downloadPDF()">Download PDF</button>
            <button type="button" class="btn" onclick="printForm()">Print Form</button>
        </div>
    </div>

    <!-- Enhanced Script with Cascading Dropdowns -->
    <script src="enhanced_script_with_locations.js?v=2.5"></script>
    
    <!-- Logo Error Handlers -->
    <script>
        function handleLogoError() {
            const logo = document.getElementById('universityLogo');
            logo.style.display = 'none';
            logo.parentElement.innerHTML = '<div style="width: 80px; height: 80px; border: 2px solid #8B4513; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #8B4513; font-weight: bold;">UoE<br>LOGO</div>';
        }
        
        function handleFooterLogoError() {
            const footerLogo = document.getElementById('footerLogo');
            if (footerLogo) {
                footerLogo.style.display = 'none';
                footerLogo.parentElement.innerHTML = '<div style="width: 60px; height: 60px; border: 2px solid #8B4513; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #8B4513; font-weight: bold; border-radius: 50%; background: #f9f9f9;">UoE<br>LOGO</div>';
            }
        }
    </script>
</body>
</html>